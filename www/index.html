<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="referrer" content="no-referrer">
    <meta name="color-scheme" content="light only">
    <meta name="theme-color" content="#F7F7F9">
    
    <title>Perchel - Premium Gastronomy Journal</title>
    
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/images/logo.png">
    
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=1bf29ed9131417186b665259385414f8&libraries=services&autoload=false"></script>
    
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <link rel="stylesheet" href="style.css">

    <style>
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            /* 4ê°€ì§€ ìƒ‰ìƒì´ ë¶€ë“œëŸ½ê²Œ ì„ì´ëŠ” ê·¸ë¼ë°ì´ì…˜ */
            background: linear-gradient(-45deg, #FF6B6B, #FFD93D, #6BCB77, #4D96FF);
            background-size: 400% 400%;
            animation: gradientBG 4s ease infinite;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 999999; /* ëª¨ë“  ìš”ì†Œë³´ë‹¤ ê°€ì¥ ìœ„ì— ìˆë„ë¡ */
            transition: opacity 0.8s ease-out, visibility 0.8s ease-out;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* ë¡œê³ ê°€ íŠ€ì–´ì˜¤ë¥´ëŠ” íš¨ê³¼ */
        .splash-logo-custom {
            font-size: 56px;
            font-weight: 900;
            color: white;
            text-shadow: 0 4px 15px rgba(0,0,0,0.2);
            animation: popIn 1s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            letter-spacing: -2px;
        }

        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* ì„œë¸Œ í…ìŠ¤íŠ¸ê°€ ë¶€ë“œëŸ½ê²Œ ì˜¬ë¼ì˜¤ëŠ” íš¨ê³¼ */
        .splash-sub-custom {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.9);
            margin-top: 16px;
            font-weight: 700;
            opacity: 0;
            letter-spacing: 2px;
            text-transform: uppercase;
            animation: fadeInUp 1s ease 0.5s forwards;
        }

        @keyframes fadeInUp {
            0% { transform: translateY(15px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        
        .splash-instruction {
            position: absolute;
            bottom: 40px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body>

    <div id="splash-screen">
        <div class="splash-logo-custom">perchel<span style="color:#FFF;">.</span></div>
        <div class="splash-sub-custom">ë‹¹ì‹ ì˜ ì·¨í–¥ í˜ì–´ë§, í¼ìŠ</div>
        <div class="splash-instruction">í™”ë©´ì„ í„°ì¹˜í•´ì„œ ë¯¸ì‹ ì—¬í–‰ì„ ì‹œì‘í•˜ì„¸ìš”</div>
    </div>

    <audio id="splash-bgm" src="bgm.mp3" preload="auto"></audio>

    <div id="pwa-install-banner">
        <div style="display:flex; align-items:center; gap:12px;">
            <div style="width:36px; height:36px; background:white; border-radius:10px; display:flex; justify-content:center; align-items:center; font-weight:900; color:var(--brand-primary);">P.</div>
            <div>
                <div style="font-size:13px; font-weight:800;">í¼ìŠ ì•± ì„¤ì¹˜í•˜ê¸°</div>
                <div style="font-size:11px; color:rgba(255,255,255,0.8);">ë°”íƒ•í™”ë©´ì—ì„œ í„°ì¹˜ í•œ ë²ˆì— ì ‘ì†í•˜ì„¸ìš”</div>
            </div>
        </div>
        <button class="pwa-btn" id="pwa-install-btn">ì„¤ì¹˜</button>
    </div>

    <div id="login-section" style="display: none; height: 100vh; flex-direction: column; align-items: center; justify-content: center; padding: 20px; position: relative; z-index: 9999; background: var(--bg-main); background-size: cover; background-position: center;">
        
        <div id="lang-toggle" class="lang-toggle" onclick="toggleLanguage()" style="position: absolute; top: 30px; right: 30px; z-index: 10; font-weight: 800; font-size: 14px; cursor: pointer; color: var(--text-main); background: rgba(255,255,255,0.8); padding: 8px 14px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">EN</div>
        
        <img src="images/logo.png" alt="Perchel Logo" onerror="this.src='/images/logo.png'" style="width: 100px; height: 100px; border-radius: 28px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); position: relative; z-index: 2; object-fit: cover;">
        
        <div style="text-align: center; margin-bottom: 40px; position: relative; z-index: 2;">
            <div data-ko="ë‹¹ì‹ ì˜ ì·¨í–¥ í˜ì–´ë§" data-en="Your Taste Pairing" style="color: #EFE9D9; font-size: 13px; font-weight: 500; margin-bottom: 6px; letter-spacing: 0.5px;">
                ë‹¹ì‹ ì˜ ì·¨í–¥ í˜ì–´ë§
            </div>
            <div data-ko="í¼ìŠ" data-en="Perchel" style="color: #EFE9D9; font-size: 24px; font-weight: 900; letter-spacing: -1.5px;">
                í¼ìŠ
            </div>
        </div>
        <div style="width: 100%; max-width: 320px; position: relative; z-index: 2;">
            <div class="social-login-container" style="display: flex; flex-direction: column; gap: 12px; margin-top: 20px;">
                
                <button class="btn-google" onclick="triggerGoogleLogin()" style="width: 100%; height: 52px; background: #FFFFFF; color: #3c4043; border: 1px solid #dadce0; border-radius: 12px; font-weight: 700; font-size: 15px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);">
                    <svg viewBox="0 0 24 24" width="20" height="20" style="margin-right: 8px;">
                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                    </svg>
                    <span data-ko="êµ¬ê¸€ë¡œ 1ì´ˆ ë¡œê·¸ì¸" data-en="Continue with Google">êµ¬ê¸€ë¡œ 1ì´ˆ ë¡œê·¸ì¸</span>
                </button>

                <button class="btn-kakao" onclick="alert('í˜„ì¬ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì„œë¹„ìŠ¤ ì¥ì• ë¡œ ì ê²€ ì¤‘ì…ë‹ˆë‹¤. ìƒë‹¨ì˜ êµ¬ê¸€ ë¡œê·¸ì¸ì„ ì´ìš©í•´ì£¼ì„¸ìš”.')" style="width: 100%; height: 52px; background: #F4F4F4; color: #999999; border: none; border-radius: 12px; font-weight: 700; font-size: 15px; display: flex; align-items: center; justify-content: center; cursor: not-allowed;">
                    <svg viewBox="0 0 24 24" width="20" height="20" style="margin-right: 8px; fill: #999999;">
                        <path d="M12 3c-5.523 0-10 3.535-10 7.896 0 2.825 1.83 5.3 4.632 6.703-.306 1.135-1.11 4.148-1.14 4.31-.035.195.14.19.223.136.068-.044 3.593-2.457 5.044-3.486.41.037.828.058 1.25.058 5.523 0 10-3.535 10-7.896C22 6.535 17.523 3 12 3z"/>
                    </svg>
                    <span data-ko="ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ (ì ê²€ ì¤‘)" data-en="Kakao Login (Maintenance)">ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ (ì ê²€ ì¤‘)</span>
                </button>
            </div>
        </div>
    </div>

    <div id="main-content">
        <header class="top-bar transparent" id="main-top-bar">
            <div class="top-bar-content">
                <div class="top-logo" onclick="switchTab('home')">perchel</div>
                <div style="display:flex; align-items:center; gap: 10px;">
                    <select id="global-region-select" onchange="changeGlobalRegion()" style="flex-shrink: 0;">
                        <option value="national" data-ko="ì „êµ­" data-en="National">ì „êµ­</option>
                        <option value="ì„œìš¸">ì„œìš¸</option><option value="ë¶€ì‚°">ë¶€ì‚°</option><option value="ëŒ€êµ¬">ëŒ€êµ¬</option><option value="ì¸ì²œ">ì¸ì²œ</option><option value="ê´‘ì£¼">ê´‘ì£¼</option><option value="ëŒ€ì „">ëŒ€ì „</option><option value="ìš¸ì‚°">ìš¸ì‚°</option><option value="ì„¸ì¢…">ì„¸ì¢…</option><option value="ê²½ê¸°">ê²½ê¸°</option><option value="ê°•ì›">ê°•ì›</option><option value="ì¶©ë¶">ì¶©ë¶</option><option value="ì¶©ë‚¨">ì¶©ë‚¨</option><option value="ì „ë¶">ì „ë¶</option><option value="ì „ë‚¨">ì „ë‚¨</option><option value="ê²½ë¶">ê²½ë¶</option><option value="ê²½ë‚¨">ê²½ë‚¨</option><option value="ì œì£¼">ì œì£¼</option>
                    </select>

                    <div class="mentor-btn" onclick="switchTab('network')" title="ë‚˜ì˜ ë¯¸ì‹ë©˜í† " style="flex-shrink: 0; width: 40px; height: 40px; border-radius: 50%; background: var(--brand-fab); display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 10px rgba(255, 90, 32, 0.4);">
                        <span data-ko="M" data-en="M" style="font-size: 22px; font-weight: 900; color: white; margin-top: 2px;">M</span>
                    </div>

                    <div onclick="openGlobalSearchModal()" style="cursor:pointer; display:flex; align-items:center; justify-content:center; flex-shrink:0;" title="ë©”ë‰´/ì‹ë‹¹ ê²€ìƒ‰"><svg class="svg-icon" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg></div>
                    <div style="position:relative; cursor:pointer; display:flex; align-items:center; justify-content:center; flex-shrink:0;" onclick="openNotificationModal()" title="ë‚´ ì†Œì‹"><svg class="svg-icon" viewBox="0 0 24 24"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg><div id="noti-badge" class="noti-badge"></div></div>
                    <div onclick="handleLogout()" style="cursor:pointer; display:flex; align-items:center; justify-content:center; flex-shrink:0;" title="ë¡œê·¸ì•„ì›ƒ"><svg class="svg-icon" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg></div>
                </div>
            </div>
        </header>

        <div id="home-view" class="tab-view premium-view" style="display:block;">
            <div class="home-top-banner-premium">
                <div class="home-top-banner-title">
                    <div style="font-size: 11px; font-weight: 600; color: #D0C9B6; letter-spacing: 1px; margin-bottom: 8px;">*GASTRONOMY CHRONICLE</div>
                    <span data-ko="ë‹¹ì‹ ì˜ ë¯¸ì‹ ì·¨í–¥ í˜ì–´ë§" data-en="Your Gastronomy Chronicle">ë‹¹ì‹ ì˜ ë¯¸ì‹ ì·¨í–¥ í˜ì–´ë§</span>
                </div>
                <div class="home-top-banner-sub" data-ko="ëª¨ë¥´ëŠ” ë¦¬ë·°ë³´ë‹¤, ë‚˜ë§Œì˜ ë¯¸ì‹ ë©˜í†  ì°¾ê¸°" data-en="Beyond reviews, find your mentor.">ëª¨ë¥´ëŠ” ë¦¬ë·°ë³´ë‹¤, ë‚˜ë§Œì˜ ë¯¸ì‹ ë©˜í†  ì°¾ê¸°</div>
            </div>
            
            <div class="home-section-container">
                <div class="section-title-premium">
                    <h2 data-ko="ì¶”ì²œ ë¯¸ì‹ ë©˜í† " data-en="Recommended Mentors">ì¶”ì²œ ë¯¸ì‹ ë©˜í† </h2>
                    <div class="section-subtitle">RECOMMENDED MENTORS</div>
                </div>
                <div class="editor-row-premium" id="editor-list-container"></div>
                
                <div class="section-title-premium" style="margin-top:50px;">
                    <h2 data-ko="íŠ¸ë Œë”© ë¯¸ì‹ ë„ê°" data-en="Trending Chronicles">íŠ¸ë Œë”© ë¯¸ì‹ ë„ê°</h2>
                    <div class="section-subtitle">TRENDING CHRONICLES</div>
                </div>
                <div class="card-grid-premium" id="popular-list-container"></div>
                
                <div class="section-title-premium" style="margin-top:50px;">
                    <h2 data-ko="ìµœê·¼ ë“±ë¡ëœ ë„ê°" data-en="Recently Added">ìµœê·¼ ë“±ë¡ëœ ë„ê°</h2>
                    <div class="section-subtitle">NEW ARRIVALS</div>
                </div>
                <div class="card-grid-premium" id="new-list-container"></div>
            </div>
        </div>

        <div id="network-view" class="tab-view" style="display:none; padding-top:80px;">
            <div style="padding: 10px 0;">
                <h2 style="font-size: 26px; font-weight: 900; margin-bottom: 5px; color: var(--text-main);" data-ko="ë‚˜ì˜ ë¯¸ì‹ë©˜í† " data-en="My Mentors">ë‚˜ì˜ ë¯¸ì‹ë©˜í† </h2>
                <div style="font-size:13px; color:var(--text-sub); margin-bottom:30px;" data-ko="ìµœê³ ì˜ ë¯¸ì‹ê°€ë“¤ì„ íŒ”ë¡œìš°í•˜ê³  ì„œì—´í‘œë¥¼ í™•ì¸í•˜ì„¸ìš”." data-en="Follow top gourmets and check their tier lists.">ìµœê³ ì˜ ë¯¸ì‹ê°€ë“¤ì„ íŒ”ë¡œìš°í•˜ê³  ì„œì—´í‘œë¥¼ í™•ì¸í•˜ì„¸ìš”.</div>
                <div class="section-title" data-ko="íŒ”ë¡œì‰" data-en="Following">íŒ”ë¡œì‰</div>
                <div id="following-list-container"></div>
                <div class="section-title" style="margin-top:40px;" data-ko="ì¶”ì²œ ë¯¸ì‹ê°€" data-en="Recommended Gourmets">ì¶”ì²œ ë¯¸ì‹ê°€</div>
                <div id="recommended-list-container"></div>
            </div>
        </div>

        <div id="explore-view" class="tab-view premium-view" style="display:none; padding-top:100px;">
            <div class="section-title-premium" style="text-align: center; margin-bottom: 30px !important;">
                <h2 data-ko="ì¸ê¸° ì‹ë‹¹ ì •ë³´" data-en="Explore">ì¸ê¸° ì‹ë‹¹ ì •ë³´</h2>
                <div class="section-subtitle">DISCOVER & FEED</div>
            </div>
            
            <div style="display:flex; gap:10px; margin-bottom:30px; justify-content:center; padding: 0 24px;">
                <button id="tab-explore-ranking" onclick="switchExploreTab('ranking')" class="explore-tab-btn active">ì‹ë‹¹ ë„ê° ì¸ê¸°ìˆœ</button>
                <button id="tab-explore-feed" onclick="switchExploreTab('feed')" class="explore-tab-btn">ì‹¤ì‹œê°„ ë¯¸ì‹ í”¼ë“œ</button>
            </div>
            
            <div id="explore-ranking-area" style="padding: 0 24px;">
                <input type="text" id="ranking-search-input" class="input-field" placeholder="ë©”ë‰´ë‚˜ ì‹ë‹¹ ì´ë¦„ì„ ê²€ìƒ‰í•˜ì„¸ìš” ğŸ”" onkeyup="if(event.keyCode==13) fetchRankingData()">
                <div style="font-size:12px; color:var(--text-sub); margin-bottom:20px; text-align:center;">ì•„ë¬´ê²ƒë„ ì…ë ¥í•˜ì§€ ì•Šê³  ë‹ë³´ê¸°ë¥¼ ëˆ„ë¥´ë©´ 'ì „ì²´ ë­í‚¹'ì´ í‘œì‹œë©ë‹ˆë‹¤.</div>
                <button class="btn-primary" style="margin-bottom:30px;" onclick="fetchRankingData()">ì‹¤ì‹œê°„ ì„œì—´í‘œ ë“±ì¬ ë­í‚¹</button>
                <div id="ranking-list-container"></div>
            </div>
            <div id="explore-feed-area" style="display:none; padding: 0 24px;"><div id="feed-scroll-area"></div></div>
        </div>
        
        <div id="map-view" class="tab-view" style="display:none; height: 100vh; padding: 60px 0 0 0;">
            <div id="global-map" style="width:100%; height:100%; background:#eee;"></div>
            <div class="my-location-btn" style="position: absolute; bottom: 100px; right: 20px; width: 44px; height: 44px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 10; cursor: pointer; border: 1px solid var(--border-color);" onclick="moveToMyLocation()" title="ë‚´ ìœ„ì¹˜ë¡œ ì´ë™">
                <svg class="svg-icon" viewBox="0 0 24 24" style="stroke:var(--brand-fab);"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg>
            </div>
        </div>

        <div id="profile-view" class="tab-view" style="display:none; padding-top:60px; padding-left:0; padding-right:0;">
            <div id="profile-header-target"></div>
            <div style="padding: 0 24px;">
                <div id="registration-trigger" style="background:var(--bg-card); border: 1px dashed var(--border-color); border-radius:var(--radius-xl); padding:24px; margin-bottom:24px; text-align:center; cursor: pointer; transition: 0.3s; box-shadow:var(--shadow-soft);" onclick="openSearchModal()">
                    <div style="font-size: 28px; color: var(--brand-fab); margin-bottom: 8px;">+</div>
                    <div data-ko="ë‚´ ë¯¸ì‹ ì„œì—´í‘œì— ë“±ë¡í•˜ê¸°" data-en="Log new experience" style="font-size: 14px; font-weight: 800; color: var(--brand-primary);">ë‚´ ë¯¸ì‹ ì„œì—´í‘œì— ë“±ë¡í•˜ê¸°</div>
                </div>
                <div id="guide-controls-target" class="guide-controls" style="display:none; margin-bottom:20px;">
                    <input type="text" id="guide-search-input" class="input-field" data-ph-ko="ì„œì—´í‘œ ë‚´ ì‹ë‹¹ ê²€ìƒ‰..." data-ph-en="Search in guide..." placeholder="ì„œì—´í‘œ ë‚´ ì‹ë‹¹ ê²€ìƒ‰..." onkeyup="renderGuideSheet()">
                </div>
                <div id="michelin-tables-target"></div>
            </div>
        </div>

        <nav class="bottom-nav">
            <div class="nav-item active" id="m-home" onclick="switchTab('home')">
                <svg class="nav-icon svg-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 10l9-7 9 7v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V10z"></path>
                    <polyline points="9 21 9 12 15 12 15 21"></polyline>
                </svg>
                <span data-ko="í™ˆ" data-en="Home">í™ˆ</span>
            </div>
            <div class="nav-item" id="m-map" onclick="switchTab('map')"><svg class="nav-icon svg-icon" viewBox="0 0 24 24"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon><line x1="8" y1="2" x2="8" y2="18"></line><line x1="16" y1="6" x2="16" y2="22"></line></svg><span data-ko="ë‚´ì£¼ë³€" data-en="Map">ë‚´ì£¼ë³€</span></div>
            <div class="nav-fab-wrapper"><div class="nav-fab" onclick="openSearchModal()"><svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg></div></div>
            <div class="nav-item" id="m-explore" onclick="switchTab('explore')"><svg class="nav-icon svg-icon" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg><span data-ko="íƒìƒ‰" data-en="Explore">íƒìƒ‰</span></div>
            <div class="nav-item" id="m-profile" onclick="switchTab('profile')"><svg class="nav-icon svg-icon" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg><span data-ko="ë‚´ í”„ë¡œí•„" data-en="Profile">ë‚´ í”„ë¡œí•„</span></div>
        </nav>
    </div>

    <div id="search-modal" class="bottom-modal">
        <div class="modal-body" style="height: 85vh;">
            <div style="padding:24px 24px 16px; display:flex; justify-content:space-between; align-items:center;">
                <h2 style="font-weight:800; font-size:20px; color:var(--brand-primary);" data-ko="ë‚˜ì˜ ì‹ë‹¹ ì°¾ê¸°" data-en="Search Place">ë‚˜ì˜ ì‹ë‹¹ ì°¾ê¸°</h2>
                <div onclick="closeSearchModal()" style="cursor:pointer; color:var(--text-sub);"><svg class="svg-icon" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div>
            </div>
            <div style="padding:0 24px 24px; flex:1; overflow-y:auto; display:flex; flex-direction:column; position: relative;">
                <input type="text" id="search-keyword" class="input-field" data-ph-ko="ì‹ë‹¹ ì´ë¦„ ì…ë ¥ í›„ Enter" data-ph-en="Search name and Enter" placeholder="ì‹ë‹¹ ì´ë¦„ ì…ë ¥ í›„ Enter" onkeypress="if(event.keyCode==13) executeKakaoSearch()">
                <div id="search-results-target" style="flex:1; margin-top:10px;"></div>
            </div>
        </div>
    </div>
    
    <div id="global-search-modal" class="bottom-modal" style="z-index: 2100;">
        <div class="modal-body" style="height: 90vh;">
            <div style="padding:24px 24px 16px; display:flex; justify-content:space-between; align-items:center;">
                <h2 style="font-weight:800; font-size:20px; color:var(--brand-primary);">ğŸ” ë©”ë‰´ & ë­í‚¹ ê²€ìƒ‰</h2>
                <div onclick="closeGlobalSearchModal()" style="cursor:pointer; color:var(--text-sub);">
                    <svg class="svg-icon" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </div>
            </div>
            <div style="padding:0 24px 24px; flex:1; overflow-y:auto; display:flex; flex-direction:column;">
                <input type="text" id="global-ranking-input" class="input-field" style="border:1px solid var(--brand-primary);" placeholder="ì˜ˆ: íŒŒìŠ¤íƒ€, ë¼ì§€ê°ˆë¹„, ì˜¤ë§ˆì¹´ì„¸..." onkeyup="if(event.keyCode==13) executeGlobalSearch()">
                <button class="btn-primary" style="margin-bottom:20px; padding:16px;" onclick="executeGlobalSearch()">ê²€ìƒ‰í•˜ê¸°</button>
                <div id="global-search-results" style="flex:1;">
                    <div style="text-align:center; padding:40px 20px; color:var(--text-sub); font-size:13px;">
                        ì›í•˜ì‹œëŠ” ë©”ë‰´ë‚˜ ì‹ë‹¹ ì´ë¦„ì„ ê²€ìƒ‰í•˜ì‹œë©´<br>ê°€ì¥ ë§ì´ ë“±ë¡ëœ ìˆœì„œëŒ€ë¡œ ë­í‚¹ì„ ë³´ì—¬ë“œë¦½ë‹ˆë‹¤.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="notification-modal" class="bottom-modal" style="z-index: 2200;">
        <div class="modal-body" style="height: 75vh;">
            <div style="padding:24px 24px 16px; display:flex; justify-content:space-between; align-items:center;">
                <h2 style="font-weight:800; font-size:20px; color:var(--brand-primary);">ğŸ”” ë‚´ ì†Œì‹</h2>
                <div onclick="closeNotificationModal()" style="cursor:pointer; color:var(--text-sub);">
                    <svg class="svg-icon" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </div>
            </div>
            <div style="padding:0; flex:1; overflow-y:auto;" id="notification-list-target">
                <div style="text-align:center; padding:40px 20px; color:var(--text-sub); font-size:13px;">ì•Œë¦¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
            </div>
        </div>
    </div>

    <div id="post-detail-modal" class="bottom-modal" style="z-index: 2300;">
        <div class="modal-body" style="height: 90vh; padding: 30px 24px; overflow-y: auto;">
            <div style="font-weight: 800; font-size: 20px; margin-bottom: 24px; display: flex; justify-content: space-between; align-items: center; color: var(--brand-primary);">
                <span data-ko="ìƒˆë¡œìš´ ë“±ê¸°" data-en="New Entry">ìƒˆë¡œìš´ ë“±ê¸°</span>
                <div onclick="cancelPosting()" style="cursor:pointer; color:var(--text-sub);">
                    <svg class="svg-icon" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </div>
            </div>
            
            <div class="preview-container">
                <div id="selected-rest-photo" style="width:100%; height:200px; background-size:cover; background-position:center; border-radius:16px; margin-bottom:12px; position:relative; overflow:hidden; border: 1px solid var(--border-color);"></div>
                <div id="map-preview-area" style="width:100%; height:150px; border-radius:16px; margin-bottom:12px; border: 1px solid var(--border-color);"></div>
            </div>
            
            <div id="selected-info-text" style="background:var(--bg-main); padding:18px; border-radius:12px; margin-bottom:20px; border: 1px solid var(--border-color);"></div>
            
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 8px;">
                <div style="font-size: 12px; font-weight: 700; color: var(--text-sub); text-transform:uppercase;" data-ko="ë¯¸ì‹í‰" data-en="Description">ë¯¸ì‹í‰</div>
                <button onclick="recommendAIComment()" style="background:rgba(255,90,32,0.1); border:1px solid var(--brand-fab); color:var(--brand-fab); border-radius:12px; padding:6px 12px; font-size:10px; font-weight:800; cursor:pointer; transition:0.2s;">
                    âœ¨ AI íë ˆì´ì…˜
                </button>
            </div>
            
            <input type="text" id="post-comment" class="input-field" data-ph-ko="ì´ ê³³ì—ì„œì˜ ê²½í—˜ì„ í•œ ì¤„ë¡œ ì ì–´ì£¼ì„¸ìš”." data-ph-en="Write your experience..." placeholder="ì´ ê³³ì—ì„œì˜ ê²½í—˜ì„ í•œ ì¤„ë¡œ ì ì–´ì£¼ì„¸ìš”.">
            
            <div style="background: rgba(0,0,0,0.03); padding: 16px; border-radius: 12px; margin-bottom: 40px; margin-top: 20px; border: 1px solid var(--border-color);">
                <div style="font-size: 12px; font-weight: 800; color: var(--text-sub); margin-bottom: 12px;">ì‚¬ì§„ ë“±ë¡ ë°©ì‹</div>
                <div style="display: flex; gap: 10px; margin-bottom: 12px;">
                    <button id="btn-photo-ai" onclick="selectPhotoMethod('ai')" style="flex: 1; padding: 10px; border-radius: 8px; border: 2px solid var(--brand-fab); background: rgba(255,90,32,0.1); color: var(--brand-fab); font-weight: 800; cursor: pointer; transition: 0.2s;">âœ¨ AI ìë™ ë§¤ì¹­</button>
                    <button id="btn-photo-manual" onclick="selectPhotoMethod('manual')" style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #ccc; background: white; color: #666; font-weight: 800; cursor: pointer; transition: 0.2s;">ğŸ“· ì§ì ‘ ì—…ë¡œë“œ</button>
                </div>
                
                <div id="manual-upload-area" style="display: none; margin-bottom: 15px;">
                   <div style="font-size: 11px; font-weight: 800; color: #888; margin-bottom: 12px; letter-spacing: 1px;">PHOTO UPLOAD</div>
    
                   <input type="file" id="post-image" accept="image/*" capture="environment" multiple style="display: none;" onchange="handleImagePreview(this)">
    
                   <label for="post-image" style="display: flex; justify-content: center; align-items: center; gap: 8px; background: #1A1A1C; border: 1px dashed #555; padding: 16px; border-radius: 12px; cursor: pointer; transition: all 0.2s;">
                       <svg viewBox="0 0 24 24" width="20" height="20" style="stroke: #FF5A20; fill: none; stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round;">
                       <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                       <circle cx="12" cy="13" r="4"></circle>
                    </svg>
                    <span style="color: #EFE9D9; font-size: 14px; font-weight: 600;">ì¹´ë©”ë¼ ì´¬ì˜ / ê°¤ëŸ¬ë¦¬ ì„ íƒ</span>
                  </label>
                </div>
                
                <div id="ai-photo-msg" style="font-size: 11px; color: var(--brand-fab); font-weight: 600;">
                    âœ“ ì¹´ì¹´ì˜¤ AIê°€ ê²€ìƒ‰í•œ ì‹ë‹¹ì˜ ëŒ€í‘œ ì‚¬ì§„ì„ ìë™ìœ¼ë¡œ ë„ì›Œì¤ë‹ˆë‹¤.
                </div>
            </div>

            <div style="display:flex; justify-content:center; padding-bottom: 40px;">
                <button onclick="executeAddRestaurant()" class="btn-primary" style="width: 100%; padding: 16px;" data-ko="ì €ì¥" data-en="Save">ì €ì¥</button>
            </div>
            
            <input type="hidden" id="h-name">
            <input type="hidden" id="h-cat">
            <input type="hidden" id="h-addr">
            <input type="hidden" id="h-id">
            <input type="hidden" id="h-x">
            <input type="hidden" id="h-y">
            <input type="hidden" id="h-phone">
        </div>
    </div>

    <div id="restaurant-detail-modal" class="bottom-modal" style="z-index: 2400;">
        <div class="modal-body" style="height: 90vh; padding: 0; overflow-y:auto; background: var(--bg-main) !important;">
            <div id="detail-view-card" style="padding: 30px 24px;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 24px;">
                    <span class="tag-pill" id="detail-tier" style="font-size:13px; padding:6px 14px; background:var(--brand-yellow); color:#000; font-weight:800; border-radius:20px;"></span>
                    <div style="display:flex; gap: 15px; align-items:center;">
                        
                        <div id="delete-rest-btn" onclick="executeDeleteRestaurant()" style="display:none; cursor:pointer;" title="ê¸°ë¡ ì‚­ì œ">
                            <svg class="svg-icon" viewBox="0 0 24 24" style="stroke:#FF4757; width:24px; height:24px;">
                                <polyline points="3 6 5 6 21 6"></polyline>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                            </svg>
                        </div>
                        
                        <div onclick="closeRestDetail()" style="cursor:pointer;">
                            <svg class="svg-icon" viewBox="0 0 24 24" style="width:28px; height:28px; stroke:#EFE9D9;"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                        </div>
                    </div>
                </div>
                
                <div id="detail-img" class="detail-main-img" style="background-position:center; background-size:cover; position:relative; overflow:hidden; border: 1px solid #333; border-radius: 16px; aspect-ratio: 4/3;">
                    <button id="ai-sync-btn" style="position:absolute; bottom:12px; right:12px; background:rgba(0,0,0,0.8); color:var(--brand-fab); border:1px solid var(--brand-fab); padding:8px 14px; border-radius:20px; font-size:11px; font-weight:800; cursor:pointer; backdrop-filter:blur(4px); display:none; transition:0.2s; box-shadow: 0 4px 10px rgba(0,0,0,0.5); z-index:20;">
                        âœ¨ AI ì‚¬ì§„ ë³€ê²½
                    </button>
                </div>

                <h2 id="detail-name" style="font-size:28px; font-weight:900; margin-bottom:12px; margin-top: 20px; color:#EFE9D9; letter-spacing:-0.5px;"></h2>
                
                <div style="display:flex; gap:8px; margin-bottom:24px; flex-wrap:wrap;">
                    <span class="tag-pill" id="detail-category" style="padding: 6px 12px; border-radius: 12px; font-size: 11px; background:rgba(255,255,255,0.1); color:#EFE9D9;"></span>
                    <span class="tag-pill" id="detail-address" style="padding: 6px 12px; border-radius: 12px; font-size: 11px; background:rgba(255,255,255,0.1); color:#EFE9D9;"></span>
                    <span class="tag-pill tag-pink" id="detail-phone" style="display:none; padding: 4px 10px; border-radius: 12px; font-size: 11px;"></span>
                </div>
                
                <div class="detail-dark-box">
                    <div class="detail-section-label">EDITOR'S COMMENT</div>
                    <div id="detail-comment" style="font-size:15px; font-weight:500; color:#EFE9D9; line-height: 1.6; font-style: italic; margin-bottom:16px;"></div>
                    
                    <div class="detail-section-label" style="margin-top:24px; border-top: 1px solid #333; padding-top: 16px;">RECOMMENDED MENU</div>
                    <div style="font-size:14px; font-weight:600; color:var(--brand-fab);">
                        ğŸ½ï¸ ì‹œê·¸ë‹ˆì²˜ ë©”ë‰´ (ì¤€ë¹„ ì¤‘)
                    </div>
                    
                    <div style="display:flex; align-items:center; gap:10px; margin-top:24px;">
                        <div id="detail-owner" style="display:inline-block; padding:8px 14px; background:rgba(255,90,32,0.1); border-radius:12px; font-size:12px; font-weight:700; color:var(--brand-fab); cursor:pointer;"></div>
                        <button id="detail-follow-btn" style="display:none; padding:8px 16px; background:var(--brand-fab); color:white; border-radius:12px; border:none; font-size:12px; font-weight:800; cursor:pointer; box-shadow: 0 4px 15px rgba(255,90,32,0.3); transition:0.2s;"></button>
                    </div>
                </div>
                    
                <div class="detail-section-label" style="margin-top: 30px;">LOCATION INFO</div>
                <div id="detail-map-area" style="width:100%; height:200px; border-radius:20px; margin-bottom:30px; border: 1px solid #333; background: #222;"></div>
                
                <button id="detail-kakao-btn" class="btn-primary" style="background:#1A1A1C!important; border:1px solid #333; color:#EFE9D9!important; display:flex; justify-content:center; align-items:center; gap:10px; margin-bottom: 50px; box-shadow:none;">ìƒì„¸ ì •ë³´ ë° ë©”ë‰´ ë³´ê¸°</button>
            </div>
        </div>
    </div>
    
    <div id="edit-profile-modal" class="bottom-modal" style="z-index: 2500;">
        <div class="modal-body" style="height: auto; min-height: 50vh; padding: 30px 24px; overflow-y:auto;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 24px;">
                <h2 style="font-weight:800; font-size:20px; color:var(--brand-primary);">í”„ë¡œí•„ ìˆ˜ì •</h2>
                <div onclick="closeEditProfileModal()" style="cursor:pointer; color:var(--text-sub);">
                    <svg class="svg-icon" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </div>
            </div>
            
            <div style="font-size: 12px; font-weight: 700; color: var(--text-sub); margin-bottom: 8px;">ìƒˆë¡œìš´ í”„ë¡œí•„ ì´ë¦„ (ë‹‰ë„¤ì„)</div>
            <input type="text" id="edit-nickname-input" class="input-field" placeholder="ë³€ê²½í•  ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”.">
            
            <div style="font-size: 12px; font-weight: 700; color: var(--text-sub); margin-bottom: 8px; margin-top: 10px;">ë‚˜ë§Œì˜ ë¯¸ì‹ ì² í•™ (Quote)</div>
            <input type="text" id="edit-philosophy-input" class="input-field" placeholder="ì˜ˆ: ìŒì‹ì€ í˜€ê°€ ì•„ë‹ˆë¼ ë¶„ìœ„ê¸°ë¡œ ë¨¹ëŠ” ê²ƒì´ë‹¤">

            <div style="font-size: 12px; font-weight: 700; color: var(--text-sub); margin-bottom: 8px; margin-top: 10px;">ë¯¸ì‹ DNA íƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„)</div>
            <input type="text" id="edit-dna-input" class="input-field" placeholder="ì˜ˆ: íŒŒì¸ë‹¤ì´ë‹, ë…¸í¬ë§¤ë‹ˆì•„, ì™€ì¸ëŸ¬ë²„">

            <div style="font-size: 12px; font-weight: 700; color: var(--text-sub); margin-bottom: 8px; margin-top: 10px;">ê¸°íƒ€ ê°œì¸ì •ë³´</div>
            <textarea id="edit-personal-info" class="input-field" placeholder="ìê¸°ì†Œê°œë‚˜ ì¶”ê°€ ê°œì¸ì •ë³´ë¥¼ ì…ë ¥í•  ìˆ˜ ìˆëŠ” ê³µê°„ì…ë‹ˆë‹¤." style="height: 80px; resize: none;"></textarea>
            
            <button onclick="submitProfileEdit()" class="btn-primary" style="margin-top: 20px;">ì €ì¥í•˜ê¸°</button>
        </div>
    </div>

    <div id="ai-image-modal" class="bottom-modal" style="z-index: 2600;">
        <div class="modal-body" style="height: auto; min-height: 50vh; padding: 30px 24px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 8px;">
                <h2 style="font-weight:800; font-size:20px; color:var(--brand-primary);">âœ¨ AI ì‚¬ì§„ íë ˆì´ì…˜</h2>
                <div onclick="document.getElementById('ai-image-modal').style.display='none'" style="cursor:pointer; color:var(--text-sub);">
                    <svg class="svg-icon" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </div>
            </div>
            <div style="font-size:13px; color:var(--text-sub); margin-bottom:20px;">ì„œë²„ê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ìˆ˜ì§‘í•œ ê³ í™”ì§ˆ ì´ë¯¸ì§€ ì¤‘<br>ëŒ€í‘œ ì‚¬ì§„ìœ¼ë¡œ ì‚¬ìš©í•  ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>
            <div id="ai-image-target" class="ai-image-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;"></div>
        </div>
    </div>

    <div id="tier-list-modal" class="bottom-modal" style="z-index: 2600;">
        <div class="modal-body" style="height: 85vh; padding: 0; background: var(--bg-main) !important;">
            <div style="padding: 24px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; position: sticky; top: 0; background: rgba(18,18,18,0.95); backdrop-filter: blur(10px); z-index: 10;">
                <h2 style="font-weight: 900; font-size: 18px; color: #EFE9D9;">ğŸ† ë‚˜ì˜ ë¯¸ì‹ ì„œì—´í‘œ</h2>
                <div onclick="document.getElementById('tier-list-modal').style.display='none'" style="cursor: pointer;">
                    <svg viewBox="0 0 24 24" style="width: 24px; height: 24px; stroke: #A09D96; fill: none; stroke-width: 2;"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </div>
            </div>
            <div id="tier-list-content" style="padding: 24px; overflow-y: auto; padding-bottom: 100px;"></div>
        </div>
    </div>

    <script src="config.js?v=2"></script>
    <script src="auth.js?v=2"></script>
    <script src="map.js?v=2"></script>
    <script src="profile.js?v=2"></script>
    <script src="feed.js?v=2"></script>
    <script src="ui.js?v=2"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const splashScreen = document.getElementById('splash-screen');
            const bgm = document.getElementById('splash-bgm');

            const startApp = () => {
                if (bgm) {
                    bgm.volume = 0.3;
                    bgm.play().catch(e => console.log("ìë™ì¬ìƒ ì •ì±…ì— ì˜í•´ ì°¨ë‹¨ë¨ (ë¸Œë¼ìš°ì € ì •ì±…)"));
                }
                
                splashScreen.style.opacity = '0';
                splashScreen.style.visibility = 'hidden';

                document.removeEventListener('click', startApp);
                document.removeEventListener('touchstart', startApp);
            };

            document.addEventListener('click', startApp);
            document.addEventListener('touchstart', startApp);
            
            setTimeout(() => {
                if (splashScreen.style.opacity !== '0') {
                    splashScreen.style.opacity = '0';
                    splashScreen.style.visibility = 'hidden';
                }
            }, 5000);
        });

        // âœ¨ 3. ì‚¬ì§„ ë“±ë¡ ë°©ì‹ ìŠ¤ìœ„ì¹˜ ë¡œì§ ì¶”ê°€
        let currentPhotoMethod = 'ai'; // ê¸°ë³¸ê°’

        function selectPhotoMethod(method) {
            currentPhotoMethod = method;
            const btnAi = document.getElementById('btn-photo-ai');
            const btnManual = document.getElementById('btn-photo-manual');
            const manualArea = document.getElementById('manual-upload-area');
            const aiMsg = document.getElementById('ai-photo-msg');
            const fileInput = document.getElementById('post-image');
            
            if(method === 'ai') {
                btnAi.style.border = '2px solid var(--brand-fab)';
                btnAi.style.background = 'rgba(255,90,32,0.1)';
                btnAi.style.color = 'var(--brand-fab)';
                btnManual.style.border = '1px solid #ccc';
                btnManual.style.background = 'white';
                btnManual.style.color = '#666';
                
                manualArea.style.display = 'none';
                aiMsg.style.display = 'block';
                if (fileInput) fileInput.value = ''; // ì§ì ‘ ì˜¬ë¦¬ë ¤ë‹¤ ì·¨ì†Œí•˜ë©´ íŒŒì¼ ì´ˆê¸°í™”
            } else {
                btnManual.style.border = '2px solid var(--brand-fab)';
                btnManual.style.background = 'rgba(255,90,32,0.1)';
                btnManual.style.color = 'var(--brand-fab)';
                btnAi.style.border = '1px solid #ccc';
                btnAi.style.background = 'white';
                btnAi.style.color = '#666';
                
                manualArea.style.display = 'block';
                aiMsg.style.display = 'none';
            }
        }
    </script>
    <script>
// =========================================================
// [CTO ì² ë²½ ë°©ì–´] ìŠ¤ë§ˆíŠ¸í° í•˜ë“œì›¨ì–´ ë’¤ë¡œê°€ê¸° = ë©”ì¸ í™”ë©´ ì´ë™ ë¡œì§
// =========================================================
// 1. ì•± ì‹¤í–‰ ì‹œ ë¯¸ë˜ì˜ ìƒíƒœ(history)ë¥¼ í•˜ë‚˜ ì–µì§€ë¡œ ë§Œë“¤ì–´ ë‘¡ë‹ˆë‹¤.
window.history.pushState({ noBackExitsApp: true }, '');

window.addEventListener('popstate', function(event) {
    let modalClosed = false;
    
    // 1ìˆœìœ„: í™”ë©´ì— ì—´ë ¤ìˆëŠ” íŒì—…/ëª¨ë‹¬ì´ ìˆë‹¤ë©´ ì „ë¶€ ì°¾ì•„ì„œ ë‹«ìŠµë‹ˆë‹¤.
    const modals = document.querySelectorAll('.bottom-modal, .modal-overlay');
    modals.forEach(m => {
        if (window.getComputedStyle(m).display !== 'none') {
            m.style.display = 'none';
            modalClosed = true;
        }
    });

    // ë°©ê¸ˆ ëª¨ë‹¬ì„ ë‹«ì•˜ë‹¤ë©´, ë‹¤ìŒ ë’¤ë¡œê°€ê¸° ë•Œ ì•±ì´ êº¼ì§€ì§€ ì•Šë„ë¡ ë‹¤ì‹œ ì´ì•Œ(ìƒíƒœ)ì„ ì¥ì „í•©ë‹ˆë‹¤.
    if (modalClosed) {
        window.history.pushState({ noBackExitsApp: true }, '');
        return; 
    }

    // 2ìˆœìœ„: ì—´ë¦° ëª¨ë‹¬ì´ ì—†ë‹¤ë©´, í˜„ì¬ í™œì„±í™”ëœ íƒ­ì´ 'í™ˆ(Home)'ì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤.
    const activeNav = document.querySelector('.nav-item.active');
    if (activeNav && activeNav.id !== 'm-home') {
        // í™ˆ íƒ­ì´ ì•„ë‹ˆë¼ë©´ í™ˆìœ¼ë¡œ ê°•ì œ ì´ë™ì‹œí‚µë‹ˆë‹¤.
        if (typeof switchTab === 'function') switchTab('home');
        
        // í™ˆìœ¼ë¡œ ì´ë™í–ˆìœ¼ë‹ˆ ë‹¤ì‹œ ì•± ì¢…ë£Œ ë°©ì§€ ì´ì•Œì„ ì¥ì „í•©ë‹ˆë‹¤.
        window.history.pushState({ noBackExitsApp: true }, '');
        return;
    }

    // 3ìˆœìœ„: í™ˆ íƒ­ì— ìˆê³ , ì—´ë ¤ìˆëŠ” íŒì—…ë„ ì—†ë‹¤ë©´
    // ì´ë•ŒëŠ” ìœ ì €ê°€ ì •ë§ ì•±ì„ ë„ê³  ì‹¶ì–´ í•˜ëŠ” ê²ƒì´ë¯€ë¡œ ì¶”ê°€ ì¥ì „ì„ í•˜ì§€ ì•Šì•„ ìì—°ìŠ¤ëŸ½ê²Œ ì•±ì´ ì¢…ë£Œë©ë‹ˆë‹¤.
});
</script>
</body>
</html>